<!DOCTYPE HTML>
<html lang="en">
<head>
<!-- Generated by javadoc (17) -->
<title>java.lang.instrument (Java SE 17 &amp; JDK 17 [build 5])</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="description" content="declaration: module: java.instrument, package: java.lang.instrument">
<meta name="generator" content="javadoc/PackageWriterImpl">
<meta name="keywords" content="java.lang.instrument package">
<link rel="stylesheet" type="text/css" href="../../../../stylesheet.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../../script-dir/jquery-ui.min.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../../jquery-ui.overrides.css" title="Style">
<script type="text/javascript" src="../../../../script.js"></script>
<script type="text/javascript" src="../../../../script-dir/jquery-3.5.1.min.js"></script>
<script type="text/javascript" src="../../../../script-dir/jquery-ui.min.js"></script>
</head>
<body class="package-declaration-page">
<script type="text/javascript">var evenRowColor = "even-row-color";
var oddRowColor = "odd-row-color";
var tableTab = "table-tab";
var activeTableTab = "active-table-tab";
var pathtoroot = "../../../../";
loadScripts(document, 'script');</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<div class="flex-box">
<header role="banner" class="flex-header"><div style="padding: 6px; text-align: center; font-size: 80%; font-family: DejaVu Sans, Arial, Helvetica, sans-serif; font-weight: normal;">This specification is not final and is subject to change. Use is subject to <a href="https://www.oracle.com/java/javase/terms/license/java17speclicense.html">license terms</a>.</div>
<nav role="navigation">
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="top-nav" id="navbar-top">
<div class="skip-nav"><a href="#skip-navbar-top" title="Skip navigation links">Skip navigation links</a></div>
<div class="about-language"><div style="margin-top: 9px;"><strong>Java SE 17 &amp; JDK 17</strong> <br><strong>DRAFT 17-crac+5-19</strong></div></div>
<ul id="navbar-top-firstrow" class="nav-list" title="Navigation">
<li><a href="../../../../index.html">Overview</a></li>
<li><a href="../../../module-summary.html">Module</a></li>
<li class="nav-bar-cell1-rev">Package</li>
<li>Class</li>
<li><a href="package-use.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../preview-list.html">Preview</a></li>
<li><a href="../../../../new-list.html">New</a></li>
<li><a href="../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../index-files/index-1.html">Index</a></li>
<li><a href="../../../../help-doc.html#package">Help</a></li>
</ul>
</div>
<div class="sub-nav">
<div>
<ul class="sub-nav-list">
<li>Package:&nbsp;</li>
<li><a href="#package-description">Description</a>&nbsp;|&nbsp;</li>
<li><a href="#related-package-summary">Related Packages</a>&nbsp;|&nbsp;</li>
<li><a href="#class-summary">Classes and Interfaces</a></li>
</ul>
</div>
<div class="nav-list-search"><label for="search-input">SEARCH:</label>
<input type="text" id="search-input" value="search" disabled="disabled">
<input type="reset" id="reset-button" value="reset" disabled="disabled">
</div>
</div>
<!-- ========= END OF TOP NAVBAR ========= -->
<span class="skip-nav" id="skip-navbar-top"></span></nav>
</header>
<div class="flex-content">
<main role="main">
<div class="header">
<div class="sub-title"><span class="module-label-in-package">Module</span>&nbsp;<a href="../../../module-summary.html">java.instrument</a></div>
<h1 title="Package java.lang.instrument" class="title">Package java.lang.instrument</h1>
</div>
<hr>
<div class="package-signature">package <span class="element-name">java.lang.instrument</span></div>
<section class="package-description" id="package-description">
<div class="block">Provides services that allow Java programming language agents to instrument
 programs running on the JVM. The mechanism for instrumentation is modification
 of the byte-codes of methods.

 <p> An agent is deployed as a JAR file. An attribute in the JAR file manifest
 specifies the agent class which will be loaded to start the agent. Agents can
 be started in several ways:

 <ol>
   <li><p> For implementations that support a command-line interface, an agent
   can be started by specifying an option on the command-line. </p></li>

   <li><p> An implementation may support a mechanism to start agents some time
   after the VM has started. For example, an implementation may provide a
   mechanism that allows a tool to <i>attach</i> to a running application, and
   initiate the loading of the tool's agent into the running application. </p></li>

   <li><p> An agent may be packaged with an application in an executable JAR
   file.</p></li>
 </ol>

 <p> Agents can transform classes in arbitrary ways at load time, transform
 modules, or transform the bytecode of methods of already loaded classes.
 Developers or administrators that deploy agents, deploy applications that
 package an agent with the application, or use tools that load agents into a
 running application, are responsible for verifying the trustworthiness of each
 agent including the content and structure of the agent JAR file.

 <p> The three ways to start an agent are described below.

 <h2>Starting an Agent from the Command-Line Interface</h2>

 <p> Where an implementation provides a means to start agents from the
 command-line interface, an agent is started by adding the following option
 to the command-line:

 <blockquote><code>
     -javaagent:&lt;jarpath&gt;[=&lt;options&gt;]
 </code></blockquote>

 where <i><code>&lt;jarpath&gt;</code></i> is the path to the agent JAR file and
 <i><code>&lt;options&gt;</code></i> is the agent options.

 <p> The manifest of the agent JAR file must contain the attribute <code>
 Premain-Class</code> in its main manifest. The value of this attribute is the
 name of the <i>agent class</i>. The agent class must implement a public
 static <code>premain</code> method similar in principle to the <code>main</code>
 application entry point. After the Java Virtual Machine (JVM) has
 initialized, the <code>premain</code> method will be called, then the real
 application <code>main</code> method. The <code>premain</code> method must return
 in order for the startup to proceed.

 <p> The <code>premain</code> method has one of two possible signatures. The
 JVM first attempts to invoke the following method on the agent class:

 <blockquote><code>
     public static void premain(String agentArgs, Instrumentation inst)
 </code></blockquote>

 <p> If the agent class does not implement this method then the JVM will
 attempt to invoke:
 <blockquote><code>
     public static void premain(String agentArgs)
 </code></blockquote>

 <p> The agent class may also have an <code>agentmain</code> method for use when
 the agent is started after VM startup (see below). When the agent is started
 using a command-line option, the <code>agentmain</code> method is not invoked.

 <p> Each agent is passed its agent options via the <code>agentArgs</code> parameter.
 The agent options are passed as a single string, any additional parsing
 should be performed by the agent itself.

 <p> If the agent cannot be started (for example, because the agent class
 cannot be loaded, or because the agent class does not have an appropriate
 <code>premain</code> method), the JVM will abort. If a <code>premain</code> method
 throws an uncaught exception, the JVM will abort.

 <p> An implementation is not required to provide a way to start agents
 from the command-line interface. When it does, then it supports the
 <code>-javaagent</code> option as specified above. The <code>-javaagent</code> option
 may be used multiple times on the same command-line, thus starting multiple
 agents. The <code>premain</code> methods will be called in the order that the
 agents are specified on the command line. More than one agent may use the
 same <i><code>&lt;jarpath&gt;</code></i>.

 <p> There are no modeling restrictions on what the agent <code>premain</code>
 method may do. Anything application <code>main</code> can do, including creating
 threads, is legal from <code>premain</code>.


 <h2>Starting an Agent After VM Startup</h2>

 <p> An implementation may provide a mechanism to start agents sometime after
 the the VM has started. The details as to how this is initiated are
 implementation specific but typically the application has already started and
 its <code>main</code> method has already been invoked. In cases where an
 implementation supports the starting of agents after the VM has started the
 following applies:

 <ol>

   <li><p> The manifest of the agent JAR must contain the attribute <code>
   Agent-Class</code> in its main manfiest. The value of this attribute is the name
   of the <i>agent class</i>. </p></li>

   <li><p> The agent class must implement a public static <code>agentmain</code>
   method. </p></li>

 </ol>

 <p> The <code>agentmain</code> method has one of two possible signatures. The JVM
 first attempts to invoke the following method on the agent class:

 <blockquote><code>
     public static void agentmain(String agentArgs, Instrumentation inst)
 </code></blockquote>

 <p> If the agent class does not implement this method then the JVM will
 attempt to invoke:

 <blockquote><code>
     public static void agentmain(String agentArgs)
 </code></blockquote>

 <p> The agent class may also have a <code>premain</code> method for use when the
 agent is started using a command-line option. When the agent is started after
 VM startup the <code>premain</code> method is not invoked.

 <p> The agent is passed its agent options via the <code>agentArgs</code>
 parameter. The agent options are passed as a single string, any additional
 parsing should be performed by the agent itself.

 <p> The <code>agentmain</code> method should do any necessary initialization
 required to start the agent. When startup is complete the method should
 return. If the agent cannot be started (for example, because the agent class
 cannot be loaded, or because the agent class does not have a conformant
 <code>agentmain</code> method), the JVM will not abort. If the <code>agentmain</code>
 method throws an uncaught exception it will be ignored (but may be logged
 by the JVM for troubleshooting purposes).


 <h2>Including an Agent in an Executable JAR file</h2>

 <p> The JAR File Specification defines manifest attributes for standalone
 applications that are packaged as <em>executable JAR files</em>. If an
 implementation supports a mechanism to start an application as an executable
 JAR then the main manifest may include the <code>Launcher-Agent-Class</code>
 attribute to specify the class name of an agent to start before the application
 <code>main</code> method is invoked. The Java virtual machine attempts to
 invoke the following method on the agent class:

 <blockquote><code>
     public static void agentmain(String agentArgs, Instrumentation inst)
 </code></blockquote>

 <p> If the agent class does not implement this method then the JVM will
 attempt to invoke:

 <blockquote><code>
     public static void agentmain(String agentArgs)
 </code></blockquote>

 <p> The value of the <code>agentArgs</code> parameter is always the empty string.

 <p> The <code>agentmain</code> method should do any necessary initialization
 required to start the agent and return. If the agent cannot be started, for
 example the agent class cannot be loaded, the agent class does not define a
 conformant <code>agentmain</code> method, or the <code>agentmain</code> method throws
 an uncaught exception or error, the JVM will abort.


 <h2> Loading agent classes and the modules/classes available to the agent
 class </h2>

 <p> Classes loaded from the agent JAR file are loaded by the
 <a href="../../../../java.base/java/lang/ClassLoader.html#getSystemClassLoader()">system class loader</a> and are
 members of the system class loader's <a href="../../../../java.base/java/lang/ClassLoader.html#getUnnamedModule()">unnamed module</a>. The system class loader typically defines the class containing
 the application <code>main</code> method too.

 <p> The classes visible to the agent class are the classes visible to the system
 class loader and minimally include:

 <ul>

   <li><p> The classes in packages exported by the modules in the <a href="../../../../java.base/java/lang/ModuleLayer.html#boot()">boot layer</a>. Whether the boot layer contains all platform
   modules or not will depend on the initial module or how the application was
   started. </p></li>

   <li><p> The classes that can be defined by the system class loader (typically
   the class path) to be members of its unnamed module. </p></li>

   <li><p> Any classes that the agent arranges to be defined by the bootstrap
   class loader to be members of its unnamed module. </p></li>

 </ul>

 <p> If agent classes need to link to classes in platform (or other) modules
 that are not in the boot layer then the application may need to be started in
 a way that ensures that these modules are in the boot layer. In the JDK
 implementation for example, the <code>--add-modules</code> command line option can
 be used to add modules to the set of root modules to resolve at startup. </p>

 <p> Supporting classes that the agent arranges to be loaded by the bootstrap
 class loader (by means of <a href="Instrumentation.html#appendToBootstrapClassLoaderSearch(java.util.jar.JarFile)"><code>appendToBootstrapClassLoaderSearch</code></a> or the <code>Boot-Class-Path</code> attribute
 specified below), must link only to classes defined to the bootstrap class loader.
 There is no guarantee that all platform classes can be defined by the boot
 class loader.

 <p> If a custom system class loader is configured (by means of the system property
 <code>java.system.class.loader</code> as specified in the <a href="../../../../java.base/java/lang/ClassLoader.html#getSystemClassLoader()"><code>getSystemClassLoader</code></a> method) then it must
 define the <code>appendToClassPathForInstrumentation</code> method as specified in
 <a href="Instrumentation.html#appendToSystemClassLoaderSearch(java.util.jar.JarFile)"><code>appendToSystemClassLoaderSearch</code></a>.
 In other words, a custom system class loader must support the mechanism to
 add an agent JAR file to the system class loader search.

 <h2>Manifest Attributes</h2>

 <p> The following manifest attributes are defined for an agent JAR file:

 <blockquote><dl>

 <dt><code>Premain-Class</code></dt>
 <dd> When an agent is specified at JVM launch time this attribute specifies
 the agent class. That is, the class containing the <code>premain</code> method.
 When an agent is specified at JVM launch time this attribute is required. If
 the attribute is not present the JVM will abort. Note: this is a class name,
 not a file name or path. </dd>

 <dt><code>Agent-Class</code></dt>
 <dd> If an implementation supports a mechanism to start agents sometime after
 the VM has started then this attribute specifies the agent class. That is,
 the class containing the <code>agentmain</code> method. This attribute is required
 if it is not present the agent will not be started. Note: this is a class name,
 not a file name or path. </dd>

 <dt><code>Launcher-Agent-Class</code></dt>
 <dd> If an implementation supports a mechanism to start an application as an
 executable JAR then the main manifest may include this attribute to specify
 the class name of an agent to start before the application <code>main</code>
 method is invoked. </dd>

 <dt><code>Boot-Class-Path</code></dt>
 <dd> A list of paths to be searched by the bootstrap class loader. Paths
 represent directories or libraries (commonly referred to as JAR or zip
 libraries on many platforms). These paths are searched by the bootstrap class
 loader after the platform specific mechanisms of locating a class have failed.
 Paths are searched in the order listed. Paths in the list are separated by one
 or more spaces. A path takes the syntax of the path component of a hierarchical
 URI. The path is absolute if it begins with a slash character ('/'), otherwise
 it is relative. A relative path is resolved against the absolute path of the
 agent JAR file. Malformed and non-existent paths are ignored. When an agent is
 started sometime after the VM has started then paths that do not represent a
 JAR file are ignored. This attribute is optional. </dd>

 <dt><code>Can-Redefine-Classes</code></dt>
 <dd> Boolean (<code>true</code> or <code>false</code>, case irrelevant). Is the ability
 to redefine classes needed by this agent. Values other than <code>true</code> are
 considered <code>false</code>. This attribute is optional, the default is <code>
 false</code>. </dd>

 <dt><code>Can-Retransform-Classes</code></dt>
 <dd> Boolean (<code>true</code> or <code>false</code>, case irrelevant). Is the ability
 to retransform classes needed by this agent. Values other than <code>true</code>
 are considered <code>false</code>. This attribute is optional, the default is
 <code>false</code>. </dd>

 <dt><code>Can-Set-Native-Method-Prefix</code></dt>
 <dd> Boolean (<code>true</code> or <code>false</code>, case irrelevant). Is the ability
 to set native method prefix needed by this agent. Values other than <code>
 true</code> are considered <code>false</code>. This attribute is optional, the default
 is <code>false</code>. </dd>

 </dl></blockquote>

 <p> An agent JAR file may have both the <code>Premain-Class</code> and <code>
 Agent-Class</code> attributes present in the manifest. When the agent is started
 on the command-line using the <code>-javaagent</code> option then the <code>
 Premain-Class</code> attribute specifies the name of the agent class and the <code>
 Agent-Class</code> attribute is ignored. Similarly, if the agent is started sometime
 after the VM has started, then the <code>Agent-Class</code> attribute specifies
 the name of the agent class (the value of <code>Premain-Class</code> attribute is
 ignored).


 <h2>Instrumenting code in modules</h2>

 <p> As an aid to agents that deploy supporting classes on the search path of
 the bootstrap class loader, or the search path of the class loader that loads
 the main agent class, the Java virtual machine arranges for the module of
 transformed classes to read the unnamed module of both class loaders.</div>
<dl class="notes">
<dt>Since:</dt>
<dd>1.5</dd>
</dl>
</section>
<section class="summary">
<ul class="summary-list">
<li>
<div id="related-package-summary">
<div class="caption"><span>Related Packages</span></div>
<div class="summary-table three-column-summary">
<div class="table-header col-first">Module</div>
<div class="table-header col-second">Package</div>
<div class="table-header col-last">Description</div>
<div class="col-plain even-row-color"><a href="../../../../java.base/module-summary.html">java.base</a></div>
<div class="col-first even-row-color"><a href="../../../../java.base/java/lang/package-summary.html">java.lang</a></div>
<div class="col-last even-row-color">
<div class="block">Provides classes that are fundamental to the design of the Java
 programming language.</div>
</div>
</div>
</div>
</li>
<li>
<div id="class-summary">
<div class="table-tabs" role="tablist" aria-orientation="horizontal"><button id="class-summary-tab0" role="tab" aria-selected="true" aria-controls="class-summary.tabpanel" tabindex="0" onkeydown="switchTab(event)" onclick="show('class-summary', 'class-summary', 2)" class="active-table-tab">All Classes and Interfaces</button><button id="class-summary-tab1" role="tab" aria-selected="false" aria-controls="class-summary.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('class-summary', 'class-summary-tab1', 2)" class="table-tab">Interfaces</button><button id="class-summary-tab2" role="tab" aria-selected="false" aria-controls="class-summary.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('class-summary', 'class-summary-tab2', 2)" class="table-tab">Classes</button><button id="class-summary-tab5" role="tab" aria-selected="false" aria-controls="class-summary.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('class-summary', 'class-summary-tab5', 2)" class="table-tab">Exceptions</button></div>
<div id="class-summary.tabpanel" role="tabpanel">
<div class="summary-table two-column-summary" aria-labelledby="class-summary-tab0">
<div class="table-header col-first">Class</div>
<div class="table-header col-last">Description</div>
<div class="col-first even-row-color class-summary class-summary-tab2"><a href="ClassDefinition.html" title="class in java.lang.instrument">ClassDefinition</a></div>
<div class="col-last even-row-color class-summary class-summary-tab2">
<div class="block">This class serves as a parameter block to the <code>Instrumentation.redefineClasses</code> method.</div>
</div>
<div class="col-first odd-row-color class-summary class-summary-tab1"><a href="ClassFileTransformer.html" title="interface in java.lang.instrument">ClassFileTransformer</a></div>
<div class="col-last odd-row-color class-summary class-summary-tab1">
<div class="block">A transformer of class files.</div>
</div>
<div class="col-first even-row-color class-summary class-summary-tab5"><a href="IllegalClassFormatException.html" title="class in java.lang.instrument">IllegalClassFormatException</a></div>
<div class="col-last even-row-color class-summary class-summary-tab5">
<div class="block">Thrown by an implementation of
 <a href="ClassFileTransformer.html#transform(java.lang.ClassLoader,java.lang.String,java.lang.Class,java.security.ProtectionDomain,byte%5B%5D)"><code>ClassFileTransformer.transform</code></a>
 when its input parameters are invalid.</div>
</div>
<div class="col-first odd-row-color class-summary class-summary-tab1"><a href="Instrumentation.html" title="interface in java.lang.instrument">Instrumentation</a></div>
<div class="col-last odd-row-color class-summary class-summary-tab1">
<div class="block">This class provides services needed to instrument Java
 programming language code.</div>
</div>
<div class="col-first even-row-color class-summary class-summary-tab5"><a href="UnmodifiableClassException.html" title="class in java.lang.instrument">UnmodifiableClassException</a></div>
<div class="col-last even-row-color class-summary class-summary-tab5">
<div class="block">Thrown by an implementation of
 <a href="Instrumentation.html#redefineClasses(java.lang.instrument.ClassDefinition...)"><code>Instrumentation.redefineClasses</code></a>
 when one of the specified classes cannot be modified.</div>
</div>
<div class="col-first odd-row-color class-summary class-summary-tab5"><a href="UnmodifiableModuleException.html" title="class in java.lang.instrument">UnmodifiableModuleException</a></div>
<div class="col-last odd-row-color class-summary class-summary-tab5">
<div class="block">Thrown to indicate that a module cannot be modified.</div>
</div>
</div>
</div>
</div>
</li>
</ul>
</section>
</main>
<footer role="contentinfo">
<hr>
<p class="legal-copy"><small><a href="https://bugreport.java.com/bugreport/">Report a bug or suggest an enhancement</a><br> For further API reference and developer documentation see the <a href="https://docs.oracle.com/pls/topic/lookup?ctx=javase17&amp;id=homepage" target="_blank">Java SE Documentation</a>, which contains more detailed, developer-targeted descriptions with conceptual overviews, definitions of terms, workarounds, and working code examples. <a href="https://docs.oracle.com/en/java/javase/index.html">Other versions.</a><br> Java is a trademark or registered trademark of Oracle and/or its affiliates in the US and other countries.<br> <a href="../../../../../legal/copyright.html">Copyright</a> &copy; 1993, 2023, Oracle and/or its affiliates, 500 Oracle Parkway, Redwood Shores, CA 94065 USA.<br>All rights reserved. Use is subject to <a href="https://www.oracle.com/java/javase/terms/license/java17speclicense.html">license terms</a> and the <a href="https://www.oracle.com/technetwork/java/redist-137594.html">documentation redistribution policy</a>. <br><strong>DRAFT 17-crac+5-19</strong> <!-- Version 17-crac+5-19 --></small></p>
</footer>
</div>
</div>
</body>
</html>
